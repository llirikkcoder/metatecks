# –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Docker

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –≤ Docker.

## ‚ö†Ô∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ production

### 1. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏

**SECRET_KEY:**
```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π SECRET_KEY
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"

# –ó–∞–º–µ–Ω–∏—Ç–µ –≤ .env.docker
SECRET_KEY=<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_–∫–ª—é—á>
```

**–ü–∞—Ä–æ–ª—å PostgreSQL:**
```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å (32+ —Å–∏–º–≤–æ–ª–æ–≤)
openssl rand -base64 32

# –ó–∞–º–µ–Ω–∏—Ç–µ –≤ .env.docker
POSTGRES_PASSWORD=<–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å>
DATABASE_URL=postgresql://metateks:<–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å>@db:5432/metateks
```

### 2. –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ Git

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env.docker –≤ .gitignore
git rm --cached .env.docker  # –ï—Å–ª–∏ —É–∂–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω
git add .gitignore
git commit -m "Remove .env.docker from git"
```

### 3. –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –ø–æ—Ä—Ç—ã –ë–î/Redis –Ω–∞—Ä—É–∂—É

–í `docker-compose.yml` –ø–æ—Ä—Ç—ã PostgreSQL (5432) –∏ Redis (6379) **–∑–∞–∫—Ä—ã—Ç—ã** –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:
```yaml
db:
  # ports: ["5432:5432"]  # –¢–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏!
```

**–í–ê–ñ–ù–û:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —ç—Ç–∏ –ø–æ—Ä—Ç—ã –≤ production!

### 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ production

–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ SSL –≤ nginx –∫–æ–Ω—Ñ–∏–≥–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:

```bash
# –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —á–µ—Ä–µ–∑ Let's Encrypt
docker-compose exec nginx certbot --nginx -d yourdomain.com
```

### 5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
ufw allow 80/tcp   # HTTP
ufw allow 443/tcp  # HTTPS
ufw allow 22/tcp   # SSH (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
ufw enable
```

---

## üîí –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

```bash
# –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ .env —Ñ–∞–π–ª–∞–º
chmod 600 .env.docker

# –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ media (–µ—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã)
chmod 750 media/
```

### –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑—ã Docker

```bash
# –û–±–Ω–æ–≤–∏—Ç–µ –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã
docker-compose pull
docker-compose up -d --build
```

### –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –ª–æ–≥–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `./logs/`:
- `django.log` - –ª–æ–≥–∏ Django
- `celery.log` - –ª–æ–≥–∏ Celery
- Nginx –ª–æ–≥–∏ - –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:**
```bash
tail -f logs/*.log
```

### –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –æ–±—ä–µ–º –ª–æ–≥–æ–≤

–î–æ–±–∞–≤—å—Ç–µ –≤ `docker-compose.yml`:
```yaml
services:
  web:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker secrets (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker Swarm secrets –≤–º–µ—Å—Ç–æ .env —Ñ–∞–π–ª–æ–≤.

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] SECRET_KEY –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π
- [ ] POSTGRES_PASSWORD –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ —Å–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
- [ ] .env.docker –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ Git
- [ ] –ü–æ—Ä—Ç—ã –ë–î/Redis –∑–∞–∫—Ä—ã—Ç—ã (–ù–ï exposed –Ω–∞—Ä—É–∂—É)
- [ ] DEBUG=False –≤ production
- [ ] ALLOWED_HOSTS —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –≤–∞—à–∏ –¥–æ–º–µ–Ω—ã
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è HTTPS
- [ ] –§–∞–π—Ä–≤–æ–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Ç–æ–ª—å–∫–æ 80, 443, 22)
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –ë–î –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

## üö® –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ —É—Ç–µ—á–∫–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

–ï—Å–ª–∏ .env.docker –ø–æ–ø–∞–ª –≤ Git –∏—Å—Ç–æ—Ä–∏—é:

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–º–µ–Ω–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –∏ –∫–ª—é—á–∏**
2. **–û—á–∏—Å—Ç–∏—Ç–µ Git –∏—Å—Ç–æ—Ä–∏—é:**
   ```bash
   # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ BFG Repo-Cleaner
   java -jar bfg.jar --delete-files .env.docker
   git reflog expire --expire=now --all
   git gc --prune=now --aggressive
   ```
3. **Force push (–û–°–¢–û–†–û–ñ–ù–û!):**
   ```bash
   git push --force
   ```
4. **–£–≤–µ–¥–æ–º–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É**

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [OWASP Docker Security](https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html)
- [Django Security Settings](https://docs.djangoproject.com/en/4.2/topics/security/)
- [Docker Security Best Practices](https://docs.docker.com/develop/security-best-practices/)
